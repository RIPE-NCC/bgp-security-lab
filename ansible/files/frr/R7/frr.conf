interface to_IXP
 ipv6 address 2001:db8:30:30::7/64
exit
!
interface lo
 ipv6 address 2001:db8:30::7/128
exit
!
interface eth0
 description "Default network, do not use"
 shutdown
exit
!
router bgp 30
 no bgp default ipv4-unicast
 neighbor 2001:db8:30:30::1 remote-as 100
 neighbor 2001:db8:30:30::9 remote-as 300
 neighbor 2001:db8:30:30::10 remote-as 400
 !
 address-family ipv6 unicast
  neighbor 2001:db8:30:30::1 activate
  neighbor 2001:db8:30:30::1 soft-reconfiguration inbound
  neighbor 2001:db8:30:30::1 route-server-client
  neighbor 2001:db8:30:30::1 route-map AS100-IMPORT in
  neighbor 2001:db8:30:30::1 route-map AS100-EXPORT out
  neighbor 2001:db8:30:30::1 attribute-unchanged next-hop
  neighbor 2001:db8:30:30::9 activate
  neighbor 2001:db8:30:30::9 soft-reconfiguration inbound
  neighbor 2001:db8:30:30::9 route-server-client
  neighbor 2001:db8:30:30::9 route-map AS300-IMPORT in
  neighbor 2001:db8:30:30::9 route-map AS300-EXPORT out
  neighbor 2001:db8:30:30::9 attribute-unchanged next-hop
  neighbor 2001:db8:30:30::10 activate
  neighbor 2001:db8:30:30::10 soft-reconfiguration inbound
  neighbor 2001:db8:30:30::10 route-server-client
  neighbor 2001:db8:30:30::10 route-map AS400-IMPORT in
  neighbor 2001:db8:30:30::10 route-map AS400-EXPORT out
  neighbor 2001:db8:30:30::10 attribute-unchanged next-hop
 exit-address-family
exit
!
ipv6 prefix-list COMMON-PREFIXES seq 5 permit 2001:db8:30:30::/64 ge 64 le 64
ipv6 prefix-list COMMON-PREFIXES seq 10 deny any
ipv6 prefix-list AS100-PREFIXES seq 5 permit 2001:db8:100::/48 ge 64 le 64
ipv6 prefix-list AS100-PREFIXES seq 10 deny any
ipv6 prefix-list AS300-PREFIXES seq 5 permit 2001:db8:200::/48 ge 64 le 64
ipv6 prefix-list AS300-PREFIXES seq 10 deny any
ipv6 prefix-list AS400-PREFIXES seq 5 permit 2001:db8:300::/48 ge 64 le 64
ipv6 prefix-list AS400-PREFIXES seq 10 deny any
!
route-map AS100-IMPORT permit 10
 call AS100-IMPORT-FROM-AS300
 match peer 2001:db8:30:30::9
exit
!
route-map AS100-IMPORT permit 20
 call AS100-IMPORT-FROM-AS400
 match peer 2001:db8:30:30::10
exit
!
route-map AS100-IMPORT-FROM-AS300 permit 10
 match ipv6 address prefix-list COMMON-PREFIXES
 set metric 100
exit
!
route-map AS100-IMPORT-FROM-AS300 permit 20
 match ipv6 address prefix-list AS300-PREFIXES
 set community 30:300
exit
!
route-map AS100-IMPORT-FROM-AS400 permit 10
 match ipv6 address prefix-list COMMON-PREFIXES
 set metric 100
exit
!
route-map AS100-IMPORT-FROM-AS400 permit 20
 match ipv6 address prefix-list AS400-PREFIXES
 set community 30:400
exit
!
route-map AS100-EXPORT permit 10
 match ipv6 address prefix-list AS100-PREFIXES
exit
!
route-map AS300-EXPORT permit 10
 match ipv6 address prefix-list AS300-PREFIXES
exit
!
route-map AS400-EXPORT permit 10
 match ipv6 address prefix-list AS400-PREFIXES
exit
!
route-map AS300-IMPORT permit 10
 call AS300-IMPORT-FROM-AS100
 match peer 2001:db8:30:30::1
exit
!
route-map AS300-IMPORT permit 20
 call AS300-IMPORT-FROM-AS400
 match peer 2001:db8:30:30::10
exit
!
route-map AS300-IMPORT-FROM-AS100 permit 10
 match ipv6 address prefix-list COMMON-PREFIXES
 set metric 100
exit
!
route-map AS300-IMPORT-FROM-AS100 permit 20
 match ipv6 address prefix-list AS100-PREFIXES
 set community 30:100
exit
!
route-map AS300-IMPORT-FROM-AS400 permit 10
 match ipv6 address prefix-list COMMON-PREFIXES
 set metric 100
exit
!
route-map AS300-IMPORT-FROM-AS400 permit 20
 match ipv6 address prefix-list AS400-PREFIXES
 set community 30:400
exit
!
route-map AS400-IMPORT permit 10
 call AS400-IMPORT-FROM-AS100
 match peer 2001:db8:30:30::1
exit
!
route-map AS400-IMPORT permit 20
 call AS400-IMPORT-FROM-AS300
 match peer 2001:db8:30:30::9
exit
!
route-map AS400-IMPORT-FROM-AS100 permit 10
 match ipv6 address prefix-list COMMON-PREFIXES
 set metric 100
exit
!
route-map AS400-IMPORT-FROM-AS100 permit 20
 match ipv6 address prefix-list AS100-PREFIXES
 set community 30:100
exit
!
route-map AS400-IMPORT-FROM-AS300 permit 10
 match ipv6 address prefix-list COMMON-PREFIXES
 set metric 100
exit
!
route-map AS400-IMPORT-FROM-AS300 permit 20
 match ipv6 address prefix-list AS300-PREFIXES
 set community 30:300
exit
